<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>

<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
    
    
<div x-ng-app="GeoApp">
  <div x-ng-controller="GeoCtrl">

    <!--    Renders our google map -->
    <div id="map">
      <div id="map-canvas"></div>
    </div>
    
    <div x-ng-show = "showBoxes" class= "row medium-block-grid-2"  >
      <div class="medium-8 columns search">
        <%= form_for(@search) do |f| %>
          <%= f.fields_for :terms do |builder| %>
            <%= builder.text_field :text, placeholder: "add a search term", class: "searchbox" %>
          <% end %>
          <%= f.submit "SEARCH", class: "button", ng_click: "showBoxes = false" %>
          <input type = "button" class = "button" id = "btnAddOne" value = "Add another term">
          <input type = "button" class = "button" id = "removeTerm" value = "Remove the last term">
      <% end %>
      </div>
    </div>

    <div class = "new-search">
      <div x-ng-hide = "showBoxes" class = "medium-6 columns">
        <a x-ng-click= "showBoxes = true" class = "custom-button-class">New Search </a>
      </div>
    </div>


    <script type="text/javascript">
      handler = Gmaps.build('Google');
      handler.buildMap({ provider: {zoom: 3, styles: [
        {"featureType": "all", "stylers": [{"saturation": -100},{"gamma": 0.5}]}], provider_key: "AIzaSyDJJPOQH24cT6ETa9IZacS7NENpUt2MKzA"}, internal: {id: 'map-canvas'}}, function(){
        
        markers1 = handler.addMarkers([
          <% if @tweets %>
            <% @tweets.each do |t| %>
              <% hasht = t.to_h %>
              <% if hasht[:coordinates] != nil %>

                <% latitude = hasht[:coordinates][:coordinates][1] %>
                <% longitude = hasht[:coordinates][:coordinates][0] %>
                  { "lat": <%= latitude.to_f %>,
                    "lng": <%= longitude.to_f %>,
                    "picture": {
                      "url": "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=|FF0000|000000",
                      "width":  40,
                      "height": 40
                    },
                    "infowindow": "<%= hasht[:text].to_s.gsub("\n","") %> ",
                    "do_clustering": false,
                    "clusterer_grid_size": 500
                  },
                <% end %>
              <% end %>
            <% end %>
          ]);

        markers2 = handler.addMarkers([
          <% if @tweets2 %>
            <% @tweets2.each do |t| %>
                <% hasht = t.to_h %>
                <% if hasht[:coordinates] != nil %>

                <% latitude = hasht[:coordinates][:coordinates][1] %>
                <% longitude = hasht[:coordinates][:coordinates][0] %>
                  { "lat": <%= latitude.to_f %>,
                    "lng": <%= longitude.to_f %>,
                    "picture": {
                      "url": "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=|0000FF|000000",
                      "width":  40,
                      "height": 40
                    },
                    "infowindow": "<%= hasht[:text].to_s.gsub("\n","") %> ",
                    "do_clustering": false,
                    "clusterer_grid_size": 500
                  },
              <% end %>
            <% end %>
          <% end %>
        ]);

        markers3 = handler.addMarkers([
          <% if @tweets3 %>
            <% @tweets3.each do |t| %>
                <% hasht = t.to_h %>
                <% if hasht[:coordinates] != nil %>

                <% latitude = hasht[:coordinates][:coordinates][1] %>
                <% longitude = hasht[:coordinates][:coordinates][0] %>
                  { "lat": <%= latitude.to_f %>,
                    "lng": <%= longitude.to_f %>,
                    "picture": {
                      "url": "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=|0000FF|000000",
                      "width":  40,
                      "height": 40
                    },
                    "infowindow": "<%= hasht[:text].to_s.gsub("\n","") %> ",
                    "do_clustering": false,
                    "clusterer_grid_size": 500
                  },
              <% end %>
            <% end %>
          <% end %>
        ]);
      });
    </script>

  </div>
</div>


